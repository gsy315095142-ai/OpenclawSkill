# 自主模式 (Autonomous Mode)

当用户发送【自主模式】指令时，Agent 进入自主执行模式，自动完成队列中的待办任务。

---

## 触发指令

**进入自主模式**：用户发送 `【自主模式】`

**退出自主模式**：用户发送 `【退出自主模式】`

---

## 自主模式执行流程

### Step 1: 检索待办任务

收到【自主模式】指令后，**立即执行**：

1. **读取任务队列**：`read TASKS.md`
2. **识别未完成任务**：标记所有状态为 `⏳ 待处理`、`⏳ 待分析`、`⏳ 待执行` 的任务
3. **向用户汇报**：
   ```
   🚀 进入自主模式
   
   发现 N 个待办任务：
   1. [任务名称] - [状态]
   2. [任务名称] - [状态]
   ...
   
   开始按顺序执行...
   ```

### Step 2: 逐条执行任务

**执行规则**（严格遵循）：

| 规则 | 说明 |
|------|------|
| **顺序执行** | 一次只执行一个任务，完成或卡住后才能执行下一个 |
| **遵守规范** | 全程遵循 `execution-standards/SKILL.md` 的行为准则 |
| **自主决策** | 用户已暂离，能自主完成的操作绝不询问 |
| **遇阻处理** | 按「遇阻停顿原则」尝试所有解决方案，失败则标记任务状态并继续下一个 |
| **进度汇报** | 每完成一个步骤，汇报当前进度 |

### Step 3: 单任务执行规范

**对于每个任务**：

```
开始任务 X: [任务名称]
    ↓
评估复杂度（< 1分钟 / > 1分钟）
    ↓
如复杂 → 拆解步骤 → 汇报计划
    ↓
逐条执行步骤
    ↓
每步完成汇报进度
    ↓
任务完成 → 更新 TASKS.md 状态为 ✅ 已完成
    ↓
汇报任务完成
    ↓
执行下一个任务
```

### Step 4: 退出自主模式

**收到【退出自主模式】时**：

1. **检查当前状态**：
   - 是否有进行中的任务？
   - 当前执行到哪个步骤？

2. **处理方式**：
   ```
   如果 有进行中的任务:
       → 汇报当前进度
       → 询问："当前任务进行至 [X%]，是否：
          A. 继续完成当前任务后退出
          B. 立即停止（任务状态保持进行中）
          C. 标记任务为失败并退出"
   
   如果 无进行中的任务:
       → "✅ 自主模式已退出，所有待办任务已处理完毕"
   ```

---

## 关键执行原则

### 1. 用户暂离 = 全权负责

**用户发送【自主模式】意味着**：
- 用户暂时无法响应
- 用户授权 Agent 自主决策
- 不要询问任何可以由 Agent 决定的事项

**自主范围**：
- ✅ 选择技术方案
- ✅ 决定文件保存位置
- ✅ 选择模型/工具
- ✅ 处理常规错误（重试、降级）
- ✅ 创建备份（自动执行）

**仍需确认的情况**：
- ❌ 涉及系统配置的修改（仍需备份+记录，但可先执行后告知）
- ❌ 可能导致数据丢失的操作
- ❌ 超出预期成本的操作（如大量 API 调用）

### 2. 遇阻不停顿（自主模式特例）

**标准遇阻停顿原则**在自主模式下调整为：

```
遇到问题:
    ↓
查阅相关 Skill（必须）
    ↓
尝试 Skill 中的所有解决方案（最多 3 种方案）
    ↓
如果 都失败:
    → 标记任务状态为 "❌ 失败 - [原因]"
    → 记录失败原因到 TASKS.md
    → 继续执行下一个任务
    → 最后统一汇报失败任务列表
```

**禁止行为**：
- ❌ 等待用户响应（用户已暂离）
- ❌ 卡住不动
- ❌ 跳过问题不记录

### 3. 定期汇报（保持信息同步）

**汇报频率**：
- **每完成一个任务**：汇报任务完成 + 总体进度
- **长时间任务**（>5分钟）：每5分钟汇报进度
- **全部完成时**：汇总报告

**汇报格式**：
```
⏰ [时间] 自主模式进展

✅ 已完成：X/Y
   - 任务1名称
   - 任务2名称

🔄 进行中：任务3名称 (50%)

⏳ 待执行：N 个

预计剩余时间：约 X 分钟
```

---

## 任务状态标记规范

在 `TASKS.md` 中更新任务状态：

| 状态 | 标记 | 使用场景 |
|------|------|---------|
| 待处理 | ⏳ 待处理 | 新任务，尚未开始 |
| 进行中 | 🔄 进行中 | 正在执行 |
| 已完成 | ✅ 已完成 | 成功完成 |
| 已失败 | ❌ 失败 | 尝试所有方案后仍失败 |
| 已暂停 | ⏸️ 暂停 | 用户中断自主模式 |

---

## 完整示例

### 场景：用户发送【自主模式】

**Agent 执行**：

```
🚀 进入自主模式

📋 发现 3 个待办任务：
1. Task 1: 分析日志文件 - ⏳ 待处理
2. Task 2: 生成周报 - ⏳ 待处理
3. Task 3: 备份数据库 - ⏳ 待处理

开始执行 Task 1...

---

⏰ [09:05] Task 1 进展
- 状态：✅ 已完成
- 结果：发现 3 个错误，已记录到 analysis.md

开始执行 Task 2...

---

⏰ [09:12] Task 2 进展
- 状态：🔄 进行中
- 进度：正在收集数据 (60%)

---

⏰ [09:18] Task 2 进展
- 状态：✅ 已完成
- 结果：周报已生成 weekly-report.md

开始执行 Task 3...

---

⏰ [09:20] Task 3 进展
- 状态：❌ 失败
- 原因：数据库连接失败，尝试重连 3 次后放弃
- 建议：请检查数据库服务状态

---

🏁 自主模式执行完毕

✅ 已完成：2/3
❌ 失败：1/3（Task 3）

退出自主模式，等待下一步指示。
```

---

## 注意事项

### 安全边界

即使处于自主模式，以下行为仍需严格遵守：

1. **配置修改必须备份**（执行前自动备份）
2. **涉及删除的操作需谨慎**（优先使用 trash 而非 rm）
3. **外部操作需记录**（发送邮件、API 调用等需记录日志）

### 性能考虑

- **任务数量过多时**（>10个）：建议分批处理，避免长时间占用
- **每个任务有超时限制**：单个任务超过30分钟仍未完成，标记为卡住，继续下一个

---

## 关联文档

- `execution-standards/SKILL.md` - 任务执行基础规范
- `TASKS.md` - 任务队列文件

---

*版本: 1.0*
*创建时间: 2026-02-15*
