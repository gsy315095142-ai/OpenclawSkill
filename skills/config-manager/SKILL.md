# OpenClaw Config Manager Skill

æœ¬ Skill å°è£…äº†å¯¹ OpenClaw æ ¸å¿ƒé…ç½®æ–‡ä»¶ (`openclaw.json` å’Œ `auth-profiles.json`) çš„å®‰å…¨ä¿®æ”¹æµç¨‹ã€‚ç”¨äºæ·»åŠ æ–°çš„ AI æä¾›å•†ã€æ¨¡å‹æˆ–æ›´æ–°è®¤è¯ä¿¡æ¯ã€‚

## é€‚ç”¨åœºæ™¯
- ç”¨æˆ·é€šè¿‡æŒ‡ä»¤ (å¦‚ "æ·»åŠ æ–°çš„ API", "æ¥å…¥ DeepSeek", "é…ç½® PoloAI") è¯·æ±‚æ‰©å±•æ¨¡å‹èƒ½åŠ›ã€‚
- éœ€è¦ä¿®æ”¹ç³»ç»Ÿæ ¸å¿ƒå‚æ•°æˆ–ç½‘å…³é…ç½®ã€‚

## æ•°æ®æºä¸è·¯å¾„
- **æ ¸å¿ƒé…ç½®**: `C:\Users\%USERNAME%\.openclaw\openclaw.json`
  - å®šä¹‰æä¾›å•† (providers)ã€æ¨¡å‹åˆ—è¡¨ (models)ã€ä»£ç†å‚æ•° (agents)ã€‚
- **è®¤è¯é…ç½®**: `C:\Users\%USERNAME%\.openclaw\agents\main\agent\auth-profiles.json`
  - å®šä¹‰å…·ä½“çš„ API Key å’Œè®¤è¯æ–¹å¼ (profiles)ã€‚

## æ ¸å¿ƒåŸåˆ™ (Safety First)
1. **å¤‡ä»½ä¼˜å…ˆ**: ä¿®æ”¹ä»»ä½• JSON å‰ï¼Œå¿…é¡»å…ˆå¤åˆ¶ä¸€ä»½ `.bak` æ–‡ä»¶ã€‚
2. **åˆ†æ­¥æ‰§è¡Œ**: å…ˆä¿®æ”¹ç»“æ„ (openclaw.json)ï¼Œé‡å¯éªŒè¯æˆåŠŸåï¼Œå†ä¿®æ”¹è®¤è¯ (auth-profiles.json)ã€‚
3. **ç¡®è®¤æœºåˆ¶**: æ¯ä¸€æ­¥ä¿®æ”¹å‰å¿…é¡»å‘ç”¨æˆ·ç¡®è®¤å…³é”®ä¿¡æ¯ (æ¨¡å‹IDã€BaseURLã€Keyç­‰)ã€‚

## 1. æ·»åŠ æ–°æä¾›å•†æµç¨‹ (Add Provider)

### æ­¥éª¤ A: æ”¶é›†ä¿¡æ¯ (Ask)
åœ¨æ‰§è¡Œä¿®æ”¹å‰ï¼Œå¿…é¡»è¯¢é—®ç”¨æˆ·ï¼š
1. **Name**: æä¾›å•†åç§° (å¦‚ `poloai`, `deepseek`)ã€‚
2. **Base URL**: æ¥å£åœ°å€ (å¦‚ `https://api.deepseek.com/v1`)ã€‚
3. **Models**: éœ€è¦æ¥å…¥çš„å…·ä½“æ¨¡å‹ ID (å¦‚ `deepseek-chat`, `gpt-4o`)ã€‚
   - *æ³¨æ„*: è¿™ä¸€æ­¥è‡³å…³é‡è¦ï¼Œå¦åˆ™æ— æ³•åœ¨é…ç½®ä¸­æ­£ç¡®æ³¨å†Œæ¨¡å‹ã€‚
4. **Key**: (å¯é€‰) API å¯†é’¥ï¼Œå¦‚æœä¸æä¾›åˆ™ç•™ç©ºå¾…ç”¨æˆ·å¡«ã€‚

### æ­¥éª¤ B: ä¿®æ”¹ openclaw.json (Structure)
1. **å¤‡ä»½**: `copy openclaw.json openclaw.json.bak.<æ—¶é—´æˆ³>`
2. **è¯»å–**: è¯»å–å½“å‰ `openclaw.json`ã€‚
3. **ç¼–è¾‘**: æ³¨å…¥æ–°æä¾›å•†å—ã€‚
   ```json
   "models": {
     "providers": {
       "<provider_name>": {
         "baseUrl": "<base_url>",
         "api": "openai-completions",
         "models": [
           { "id": "<model_id>", "name": "<display_name>", ... } // å¿…é¡»åŒ…å«ç”¨æˆ·æŒ‡å®šçš„å…·ä½“æ¨¡å‹ID
         ]
       }
     }
   }
   ```
4. **æ³¨å…¥çŸ­åˆ«å (Alias)**:
   - åœ¨ `agents.defaults.models` ä¸­ä¸ºæ–°æ¨¡å‹æ·»åŠ  aliasï¼ˆå¦‚ `claude-opus-4-6`ï¼‰ï¼Œæ–¹ä¾¿ç”¨æˆ·è°ƒç”¨ã€‚
5. **åº”ç”¨**: è°ƒç”¨ `gateway config.apply` åº”ç”¨å˜æ›´ (ä¼šè‡ªåŠ¨é‡å¯)ã€‚

### æ­¥éª¤ C: ä¿®æ”¹ auth-profiles.json (Secret)
1. **å¤‡ä»½**: `copy auth-profiles.json auth-profiles.json.bak`
2. **è¯»å–**: è¯»å–å½“å‰æ–‡ä»¶ã€‚
3. **ç¼–è¾‘**:
   - **Step 1**: æ·»åŠ è®¤è¯ profileã€‚
     ```json
     "profiles": {
       "<provider_name>:default": {
         "provider": "<provider_name>",
         "type": "api_key",
         "key": "<api_key_placeholder>"
       }
     }
     ```
   - **Step 2 (å¿…é¡»)**: æ›´æ–° `lastGood` æŒ‡é’ˆã€‚
     ```json
     "lastGood": {
       "<provider_name>": "<provider_name>:default"
     }
     ```
   - **Step 3 (å¯é€‰)**: åˆå§‹åŒ– `usageStats` ä»¥ä¿æŒç»“æ„å®Œæ•´ã€‚
     ```json
     "usageStats": {
       "<provider_name>:default": { "lastUsed": 0, "lastFailureAt": 0, "errorCount": 0 }
     }
     ```
4. **é€šçŸ¥**: å‘ŠçŸ¥ç”¨æˆ· key å·²é¢„ç•™ï¼Œè¯·æ‰‹åŠ¨å¡«å†™æˆ–æä¾›ã€‚

## 2. ä¿®æ”¹ç°æœ‰é…ç½® (Update Config)
... (åŒ…æ‹¬ä¿®æ”¹æ¨¡å‹å‚æ•°ã€åˆ‡æ¢é»˜è®¤æ¨¡å‹ç­‰)

---

## 3. å¸¸è§é”™è¯¯ä¸ç»éªŒ (Common Errors & Lessons) â­ **2026-02-15 æ–°å¢**

### 3.1 æ¨¡å‹é…ç½®å­—æ®µé™åˆ¶

**é—®é¢˜**ï¼šåœ¨ `openclaw.json` çš„æ¨¡å‹é…ç½®ä¸­æ·»åŠ  `"output": ["image", "text"]` å­—æ®µ

**åæœ**ï¼šGateway å¯åŠ¨å¤±è´¥ï¼ŒæŠ¥é”™æç¤ºä¸æ”¯æŒçš„å­—æ®µ

**åŸå› **ï¼š
- OpenClaw æ¨¡å‹é…ç½® Schema **ä¸æ”¯æŒ `output` å­—æ®µ**
- ä»…æ”¯æŒï¼š`id`, `name`, `input`, `cost`, `contextWindow`, `maxTokens`, `reasoning`

**æ­£ç¡®åšæ³•**ï¼š
```json
{
  "id": "google/gemini-3-pro-image-preview",
  "name": "Gemini 3 Pro Image Preview",
  "input": ["text", "image"],
  // âŒ ä¸è¦æ·»åŠ  "output": ["image", "text"]
  "cost": { "input": 5, "output": 15 },
  "contextWindow": 1000000,
  "maxTokens": 8192
}
```

**æ³¨æ„**ï¼š`input` å­—æ®µä¸­çš„ `"image"` ä»…è¡¨ç¤º**è§†è§‰ç†è§£èƒ½åŠ›**ï¼ˆçœ‹å›¾ï¼‰ï¼Œä¸ä»£è¡¨**å›¾ç‰‡ç”Ÿæˆèƒ½åŠ›**ã€‚

---

### 3.2 Heartbeat é…ç½®ä½ç½®

**é—®é¢˜**ï¼šåœ¨ `openclaw.json` æ ¹çº§åˆ«æ·»åŠ  `heartbeat` é…ç½®

**åæœ**ï¼šGateway å¯åŠ¨å¤±è´¥ï¼ŒæŠ¥é”™æç¤ºä¸æ”¯æŒçš„å­—æ®µ

**åŸå› **ï¼š
- `openclaw.json` **æ ¹çº§åˆ«ä¸æ”¯æŒ `heartbeat` å­—æ®µ**
- Heartbeat é…ç½®åº”è¯¥æ”¾åœ¨ `agents.defaults.heartbeat` æˆ–å…·ä½“ agent é…ç½®ä¸­

**æ­£ç¡®åšæ³•**ï¼š
```json
{
  "agents": {
    "defaults": {
      "heartbeat": {
        "every": "30s",
        "prompt": "Read HEARTBEAT.md if it exists..."
      }
    }
  }
}
```

**æ³¨æ„**ï¼š`heartbeat` ä¸æ˜¯æ ¹çº§é…ç½®é¡¹ï¼Œå¿…é¡»æ”¾åœ¨ `agents.defaults` æˆ– `agents.list[].heartbeat` ä¸­ã€‚

#### ä¿®å¤æ¡ˆä¾‹ï¼ˆ2026-02-16ï¼‰

**é—®é¢˜ç°è±¡**ï¼š
- Heartbeat é…ç½®æ”¾åœ¨ `hooks.internal.entries.heartbeat`
- ä¼šè¯å¯åŠ¨æ—¶**æ²¡æœ‰è‡ªåŠ¨è§¦å‘**å¯åŠ¨ç¡®è®¤æµç¨‹
- éœ€è¦æ‰‹åŠ¨å‘é€æ¶ˆæ¯æ‰èƒ½æ¿€æ´»

**é”™è¯¯é…ç½®**ï¼š
```json
"hooks": {
  "internal": {
    "entries": {
      "heartbeat": {
        "enabled": true,
        "prompt": "Read HEARTBEAT.md..."
      }
    }
  }
}
```

**ä¿®å¤æ­¥éª¤**ï¼š
1. å¤‡ä»½ `openclaw.json`
2. åˆ é™¤ `hooks.internal.entries` ä¸­çš„ `heartbeat` èŠ‚ç‚¹
3. åœ¨ `agents.defaults` ä¸­æ·»åŠ æ­£ç¡®çš„ `heartbeat` é…ç½®ï¼š
```json
"agents": {
  "defaults": {
    "heartbeat": {
      "every": "30s",
      "prompt": "Read HEARTBEAT.md if it exists..."
    }
  }
}
```
4. é‡å¯ Gateway

**éªŒè¯æˆåŠŸ**ï¼š
- é‡å¯åä¼šè¯è‡ªåŠ¨è§¦å‘ Heartbeat
- è‡ªåŠ¨è¯»å– `HEARTBEAT.md` å’Œä»»åŠ¡æ‰§è¡Œè§„èŒƒ
- è‡ªåŠ¨å‘é€å¯åŠ¨ç¡®è®¤æ¶ˆæ¯

---

#### 3.2.1 Heartbeat é—´éš”è®¾ç½®æ•™è®­ â­ **2026-02-16 æ–°å¢**

**é—®é¢˜**ï¼šå°† Heartbeat é—´éš”è®¾ç½®ä¸º 30 ç§’ï¼ˆ`"every": "30s"`ï¼‰

**åæœ**ï¼š
- ğŸ”´ **Token æ¶ˆè€—å·¨å¤§**ï¼šæ¯ 30 ç§’è§¦å‘ä¸€æ¬¡ LLM è°ƒç”¨
- ğŸ”´ **è´¹ç”¨é£™å‡**ï¼šé¢‘ç¹è°ƒç”¨å¯¼è‡´ API è´¹ç”¨æ€¥å‰§å¢åŠ 
- ğŸ”´ **æ€§èƒ½ä¸‹é™**ï¼šä¸å¿…è¦çš„é¢‘ç¹å¤„ç†å ç”¨ç³»ç»Ÿèµ„æº

**åŸå› åˆ†æ**ï¼š
- æ¯æ¬¡ Heartbeat éƒ½ä¼šè§¦å‘ä¸€æ¬¡å®Œæ•´çš„ LLM å“åº”ï¼ˆå³ä½¿å›å¤ `HEARTBEAT_OK`ï¼‰
- 30 ç§’é—´éš”æ„å‘³ç€ï¼š
  - æ¯å°æ—¶ 120 æ¬¡è°ƒç”¨
  - æ¯å¤© 2,880 æ¬¡è°ƒç”¨
  - æŒ‰å¹³å‡ 500 tokens/æ¬¡è®¡ç®—ï¼šæ¯å¤©çº¦ 144 ä¸‡ tokensï¼

**æ­£ç¡®åšæ³•**ï¼š
```json
{
  "agents": {
    "defaults": {
      "heartbeat": {
        "every": "1800s",  // â† æ”¹ä¸º 30 åˆ†é’Ÿï¼ˆ1800ç§’ï¼‰
        "prompt": "Read HEARTBEAT.md if it exists..."
      }
    }
  }
}
```

**æ¨èé—´éš”**ï¼š
| ä½¿ç”¨åœºæ™¯ | æ¨èé—´éš” | è¯´æ˜ |
|---------|---------|------|
| å¼€å‘æµ‹è¯• | 30s - 60s | å¿«é€ŸéªŒè¯åŠŸèƒ½ |
| æ—¥å¸¸ä½¿ç”¨ | 300s - 600s | 5-10 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ |
| **ç”Ÿäº§ç¯å¢ƒ** | **1800s - 3600s** | **30-60 åˆ†é’Ÿï¼ˆæ¨èï¼‰** |
| ä½é¢‘ç›‘æ§ | 7200s+ | ä»…ç”¨äºé•¿æ—¶é—´ç¦»çº¿æ£€æµ‹ |

**ç»éªŒæ•™è®­**ï¼š
> "Heartbeat ä¸æ˜¯å¿ƒè·³ç›‘æµ‹ï¼Œæ˜¯å®šæ—¶ä»»åŠ¡è§¦å‘å™¨"
> "é—´éš”è¶ŠçŸ­ â‰  è¶Šå¥½ï¼ŒToken æ¶ˆè€—ä¸é—´éš”æˆåæ¯”"
> **é»˜è®¤æ¨è 1800 ç§’ï¼ˆ30 åˆ†é’Ÿï¼‰ä½œä¸ºå¹³è¡¡ç‚¹å’Œèµ·ç‚¹**

---

### 3.3 é…ç½®ä¿®æ”¹ checklist

ä¿®æ”¹ `openclaw.json` å‰å¿…é¡»æ£€æŸ¥ï¼š

| æ£€æŸ¥é¡¹ | è¯´æ˜ |
|--------|------|
| âœ… å¤‡ä»½ | å…ˆåˆ›å»º `.bak` å¤‡ä»½æ–‡ä»¶ |
| âœ… å­—æ®µæœ‰æ•ˆæ€§ | ç¡®è®¤æ–°å¢å­—æ®µåœ¨ Schema ä¸­æ”¯æŒ |
| âœ… JSON æ ¼å¼ | ç¡®ä¿æ²¡æœ‰è¯­æ³•é”™è¯¯ï¼ˆé€—å·ã€æ‹¬å·åŒ¹é…ï¼‰|
| âœ… é‡å¯éªŒè¯ | ä¿®æ”¹åé‡å¯ Gateway éªŒè¯æ˜¯å¦æ­£å¸¸ |

**å®‰å…¨åŸåˆ™**ï¼š
> "å®å¯å¤šå¤‡ä»½ä¸€æ¬¡ï¼Œä¸è¦ä¿®å¤ä¸€æ¬¡æ•…éšœ"
> "ä¸ç¡®å®šçš„å­—æ®µï¼Œå…ˆæŸ¥æ–‡æ¡£å†æ·»åŠ "
