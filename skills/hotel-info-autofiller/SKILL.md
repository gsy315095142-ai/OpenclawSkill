---
name: hotel-info-autofiller
description: 自动化填充酒店信息到QikeyaGarden项目系统。当需要为项目系统中的酒店自动填充信息（客户地址、业主方、品牌方、总房数、亲子房数量等）时使用。流程：读取项目系统中的携程链接 → 使用web_fetch抓取酒店详情 → 解析关键字段 → 自动填写回项目系统。适用于批量处理多个酒店的空字段填充。
---

# Hotel Info Autofiller - 酒店信息自动填充

自动化从携程抓取酒店信息并填充到QikeyaGarden项目系统的工作流程。

## 项目系统配置

| 配置项 | 值 | 说明 |
|--------|-----|------|
| **系统名称** | QikeyaGarden / EcoManor Simulator | 奇趣庄园项目管理系统 |
| **URL** | http://test-marketing-tool.lixiaoqian.com/ | 测试环境地址 |
| **登录方式** | 手机号登录 | 无需密码 |
| **登录账号** | 13959242512 | 郭郭的手机号 |
| **省份入口** | 省份江山图 / 省份孵化图 | 两个入口都能进入省份，但对应省份不同 |
| **酒店列表** | 田地总览 | 显示该省份所有酒店 |

### 省份入口说明

**省份江山图**：
- 入口按钮：`ref=e47` 或 `ref=e60` (省份江山图)
- 对应省份：浙江、福建、上海等（开花期及以上省份）

**省份孵化图**：
- 入口按钮：`ref=e48` (省份孵化图)
- 对应省份：其他省份（不同阶段的省份）

**选择建议**：
- 优先使用江山图入口（更稳定）
- 如果目标省份不在江山图中，尝试孵化图入口
- 两个入口的功能相同，只是显示的省份集合不同
| **编辑入口** | 查看/编辑植物信息 | 点击后进入酒店详情编辑页 |

### 页面元素定位（aria-ref）

```
省份入口: ref=e101 (福建)
酒店列表项: ref=e244 (厦门海景洲际酒店示例)
编辑按钮: ref=e253 (查看/编辑植物信息)
地址字段: ref=e464
业主方字段: ref=e468
品牌方字段: ref=e471
总房数字段: ref=e475
亲子房数字段: ref=e478
携程链接字段: ref=e501
保存按钮: ref=e558
```

**注意**: ref 值会随页面状态变化，使用前需先获取最新 snapshot。

## 核心流程

```
1. 登录项目系统 → 读取酒店列表
2. 筛选有携程链接但信息不全的酒店
3. 使用 web_fetch 抓取携程详情页
4. 解析关键字段（地址、品牌、房数等）
5. 自动填写回项目系统
6. 生成处理报告
```

## 关键字段映射

| 项目系统字段 | 携程数据源 | 说明 |
|-------------|-----------|------|
| 客户地址 | 酒店简介中的位置描述 | 提取城市和具体地址 |
| 品牌方 | 酒店名称或品牌信息 | 如"香格里拉"、"洲际"等 |
| 总房数 | 酒店简介中的"客房数" | 如"客房数：325" |
| 业主方 | 通常不公开 | 标注为"未公开" |
| 亲子房数量 | 房型列表 | 携程通常不显示具体数量，需人工核实 |
| 携程链接 | 用户提供 | 必填字段，作为抓取入口 |

## 抓取数据示例

**厦门香格里拉酒店抓取结果：**
- URL: `https://hotels.ctrip.com/hotels/detail/?hotelId=9118583`
- 地址：厦门东部新兴国际商务中心，环岛路一线海景，观音山附近
- 品牌：香格里拉
- 总房数：325间
- 亲子房：有亲子大床房（具体数量未标注）

## 技术要点

### 1. 浏览器选择
- **Chrome Extension (Browser Relay)**: 用于操作项目系统（需手动attach）
- **web_fetch**: 用于抓取携程数据（无需浏览器，稳定可靠）

### 2. 数据提取技巧
- 使用 `web_fetch` 的 `extractMode: "markdown"` 获取结构化文本
- 从酒店简介中提取地址、客房数、品牌信息
- 关键词搜索："客房数"、"位于"、"开业"

### 3. 缺失数据处理
- **业主方**: 标注为"未公开"（携程通常不显示）
- **亲子房数量**: 标注为"0"或待核实（携程未明确标注数量）
- **地址不完整**: 结合城市名和描述补全

### 4. 字段填写技巧（⚠️ 重要！）

**常见错误**: 仅使用 `click` 操作点击字段，但忘记使用 `type` 操作输入文本，导致数据看似填写但实际未保存。

**错误示例（会导致数据丢失）**:
```javascript
// ❌ 错误：只点击字段，没有实际输入内容
await browser({ action: "act", request: { kind: "click", ref: "e2115" }});
```

**正确示例（必须实际输入文本）**:
```javascript
// ✅ 正确：使用 type 操作输入实际文本
await browser({ 
  action: "act", 
  request: { kind: "type", ref: "e2118", text: "香格里拉" }
});

await browser({ 
  action: "act", 
  request: { kind: "type", ref: "e2115", text: "未公开" }
});
```

**验证方法**: 填写字段后，重新获取页面快照验证文本是否真正写入：
```javascript
const snapshot = await browser({ action: "snapshot", targetId, refs: "aria" });
// 检查对应 textbox 的 value 值是否正确
```

**总结**: 填写任何文本字段时，必须使用 `type` 操作输入实际内容，不能仅用 `click` 操作点击字段。

## 使用步骤

### 单酒店处理
1. 用户确保酒店已填写携程链接
2. 使用 `browser` 工具连接 Chrome Extension
3. 导航到酒店编辑页面，读取携程链接
4. 使用 `web_fetch` 抓取链接内容
5. 解析关键字段
6. 使用 `browser` 填写回项目系统
7. 保存并确认

### 批量处理
1. 遍历项目系统中的所有酒店
2. 筛选条件：有携程链接 && (地址为空 || 品牌为空 || 总房数为空)
3. 对每个符合条件的酒店执行单酒店处理流程
4. 生成批量处理报告

## 注意事项

1. **登录状态**: 项目系统需要登录（手机号 13959242512）
   - 登录后状态会保持一段时间，但新对话或长时间未操作可能需要重新登录
   - 重新登录步骤：输入手机号 → 点击"进入庄园"
   
2. **Browser Relay**: 每次操作前需确保页面已attach
   - 用户需要手动点击 Chrome 工具栏的 OpenClaw 图标 attach 标签页
   - 如页面刷新或切换，需要重新 attach
   
3. **数据保护**: 只填充空字段，不覆盖已有数据
4. **亲子房数量**: 携程页面通常不明确标注，可能需要人工核实
5. **业主方**: 通常不公开显示，标记为"未公开"
6. **页面导航**: **绝对禁止使用 navigate 操作刷新页面！**
   - 必须在同一标签页内完成所有操作，保持稳定的 targetId
   - 页面跳转必须通过点击页面内的按钮或链接实现
   - 使用浏览器后退功能时，必须通过页面UI元素，而非工具命令
   - 任何可能导致页面刷新的操作都是严格禁止的
7. **截图记录**: 每更新完一个酒店的数据，必须立即截图保存
   - 截图应包含完整的酒店信息编辑页面，显示已填写的数据
   - 截图文件必须保存在 `clawd/Project/hotel-data-updates/YYYY-MM-DD/` 目录下（按日期分文件夹）
   - 文件命名格式：`省份-酒店中文名-数据状态-YYYYMMDD.png`
   - 截图后必须向用户汇报截图保存的具体路径

## 截图规范与最佳实践（重要！）

### 📸 截图时机与页面要求
1. **必须在编辑页面截图** - 截图必须显示"植物信息"编辑页面（包含酒店基础信息表单），而非田地总览列表页面
2. **截图前确保数据已填写完整** - 包括：客户地址、品牌方、总房数、业主方
3. **截图后再点击保存** - 避免保存后页面跳转回列表页导致截图错误

### 🔄 页面导航规范
1. **返回列表页使用页面按钮** - 点击编辑页面左上角的返回箭头，而非使用 `navigate` 命令
2. **避免使用 navigate 刷新页面** - 这会导致 Chrome 扩展断开连接
3. **在同一标签页内完成操作** - 从登录 → 省份 → 酒店编辑 → 截图，保持 targetId 稳定

### 📝 操作流程标准
```
1. 进入酒店编辑页面（点击"查看/编辑植物信息"）
2. 检查并填写所有字段（地址、品牌、房数、业主方）
3. 截图编辑页面（显示完整填写后的表单）
4. 点击保存修改
5. 使用页面返回按钮回到列表
6. 处理下一家酒店
```

### ⚠️ 常见错误避免
- ❌ 错误：在田地总览页面截图（显示酒店卡片而非编辑表单）
- ✅ 正确：在植物信息编辑页面截图（显示完整的酒店基础信息表单）
- ❌ 错误：点击保存后立即截图（页面已跳转）
- ✅ 正确：填写完成后、保存前截图，或使用返回按钮回到编辑页截图
- ❌ 错误：长时间操作不汇报进度
- ✅ 正确：每完成一个步骤及时向用户汇报进度
7. **自动化原则**: 
   - **绝对不允许建议用户手动填写**：所有操作必须通过自动化完成，即使遇到技术困难也要寻找自动化解决方案
   - **禁止刷新网页操作**：使用 `browser.navigate` 会刷新页面并导致Chrome扩展断开连接，必须避免。所有导航应通过点击页面元素完成，保持现有会话状态

## 相关资源

- `references/workflow.md` - 详细工作流程和代码示例
- `scripts/` - 可复用的自动化脚本

## 使用指令（触发词）

当用户说以下任意一种表达时，自动触发此 skill：

### 单酒店处理
- "填充 XX 酒店的信息"
- "抓取 XX 酒店的携程数据"
- "自动填写 XX 酒店的地址/品牌/房数"
- "更新 XX 酒店的信息"

### 批量处理
- "批量填充酒店信息"
- "处理所有有携程链接的酒店"
- "自动填充福建省的酒店"
- "批量更新酒店数据"

### 通用指令
- "启动酒店信息填充"
- "使用 hotel-info-autofiller"
- "自动填充酒店"

## 配置指南（适配自己的项目系统）

如果其他用户要使用此 skill，需要根据自己的项目系统更新以下配置：

### 1. 项目系统信息
在 `SKILL.md` 的「项目系统配置」表格中更新：
- **URL**: 替换为自己的项目系统地址
- **登录账号**: 替换为自己的手机号/用户名
- **登录方式**: 如有密码也需要记录

### 2. 页面元素定位
不同项目系统的页面结构不同，需要重新获取 aria-ref 值：
```javascript
// 获取最新页面快照
const snapshot = await browser({ 
  action: "snapshot", 
  targetId, 
  refs: "aria" 
});
// 从 snapshot 中提取各字段的最新 ref 值
```

### 3. 字段映射调整
如果项目系统的字段名称不同，更新「关键字段映射」表格。

### 4. 省份入口
如果项目系统的省份入口名称不同（如不叫"江山图"），更新入口说明。

## 使用示例

### 示例1：单酒店填充

**用户**：填充厦门海景洲际酒店的信息

**助手执行**：
1. 连接 Chrome Extension
2. 登录项目系统（13959242512）
3. 导航到福建省 → 厦门海景洲际酒店
4. 读取携程链接
5. web_fetch 抓取携程详情
6. 解析并填写地址、品牌、房数
7. 保存并汇报结果

### 示例2：批量填充

**用户**：批量处理福建省所有有携程链接的酒店

**助手执行**：
1. 登录项目系统
2. 遍历福建省所有酒店
3. 筛选有携程链接但信息不全的酒店
4. 逐个抓取并填充
5. 生成批量处理报告

### 示例3：特定条件处理

**用户**：填充所有总房数为空的酒店

**助手执行**：
1. 扫描所有省份
2. 筛选总房数为空且有携程链接的酒店
3. 批量抓取并填充
4. 汇报处理结果

## 故障排除

### Q1: 无法登录项目系统？
- 检查 URL 是否正确
- 确认账号密码（或手机号）
- 检查网络连接

### Q2: Browser Relay 无法 attach？
- 确保 Chrome 已安装 OpenClaw 扩展
- 手动点击扩展图标 attach 标签页
- 确保页面已完全加载

### Q3: 携程抓取失败？
- 检查携程链接是否有效
- 确认链接格式正确（ hotels.ctrip.com/hotels/XXXXX ）
- 可能需要验证码或登录携程

### Q4: 字段填写失败？
- 检查 ref 值是否过期（获取最新 snapshot）
- 确认字段是否可编辑
- 检查是否已登录项目系统

### Q5: 找不到目标酒店？
- 确认省份入口正确（江山图 vs 孵化图）
- 检查酒店名称拼写
- 确认酒店是否存在于项目系统中

## 成功案例

**厦门香格里拉酒店**（2026-02-11）
- 客户地址：✅ 已填充
- 品牌方：✅ 已填充（香格里拉）
- 总房数：✅ 已填充（325间）
- 业主方：✅ 已填充（未公开）
- 亲子房数量：⚠️ 待核实（携程未标注）

**厦门海景洲际酒店**（2026-02-11）
- 客户地址：✅ 已填充（福建省厦门市思明区环岛路）
- 品牌方：✅ 已填充（洲际酒店）
- 总房数：✅ 已填充（289间）
- 业主方：✅ 已填充（未公开）
- 携程链接：✅ 已提供
