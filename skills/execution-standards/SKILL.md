# Execution Standards (执行任务规范)

此 Skill 定义了 Agent 在执行任务时的通用行为准则和底线原则。

## 1. 遇阻停顿原则 (Stop-and-Ask Protocol)

**触发条件**：
当任务执行过程中遇到客观阻碍、工具限制或关键信息缺失（例如：联网搜索失败、API 权限不足、资料完全缺失）时。

**严禁行为**：
- ❌ **严禁瞎编**：绝对不可使用幻觉数据或未经证实的信息来填充空白。
- ❌ **严禁隐瞒**：不可默默跳过该步骤而假装已完成。
- ❌ **严禁擅自妥协**：不可自作主张选择一个可能降低交付质量的"临时替代方案"（除非该方案完全无损）。

**标准执行流程**：
1. **立即暂停 (STOP)**：停止当前自动化流程。
2. **汇报情况 (REPORT)**：向用户诚实说明遇到的具体困难（如："尝试搜索资料时发现 API Key 失效"）。
5. **汇报情况 (PROPOSE)**：根据现有能力，提供 2-3 个可行的替代解决路径。
   - *方案 A*：请求用户协助（如"请提供相关文本/Key"）。
   - *方案 B*：降级处理（如"暂时留白，标记待补充"）。
   - *方案 C*：替代路径（如"尝试查阅本地知识库"）。
6. **等待指令 (ASK)**：明确询问用户希望执行哪一种方案，获得确认后再继续。

## 3. 任务评估与拆解规范 (Assessment & Chunking)

**3.1 事前评估**
在执行任何任务前，必须预估其耗时与复杂度：
- **快速任务**（预计耗时 < 1分钟）：按现有方式直接执行。
- **复杂任务**（预计耗时 > 1分钟，或涉及多文件/多步骤/不确定性高）：**进入拆解流程**。

**3.2 拆解与确认 (Plan & Confirm)**
对于复杂任务：
1. **制定计划**：将任务拆解为清晰的步骤清单（Step 1, Step 2, Step 3...）。
2. **请求确认**：向用户展示计划，**等待用户明确确认**后方可开始。

**3.3 步进式执行 (Step-by-Step Execution)**
获得确认后：
- **执行方式**：严禁一次性 Spawn 所有步骤。必须将其拆分为独立的工具调用。
- **进度汇报**：每完成一个步骤，**必须**向用户发送一条进度消息（更新步骤清单状态，如 "✅ Step 1 完成，正在执行 Step 2..."）。
- **流式推进**：汇报后若无错误，自动继续执行下一步，直到全部完成。

**目的**：
- 确保用户随时掌控进度。
- 规避单线程阻塞导致的"死机"错觉。
- 发生错误时可及时止损。

## 4. 工作区组织规范 (Workspace Organization)

**4.1 项目隔离原则**
- **定义**：任何由 Agent 执行并生成的**具体项目交付物**（如网页、脚本、报告、数据文件等），不应散落在工作区根目录。
- **规范**：必须在 `clawd/Project/` 目录下创建子文件夹进行分类存储。
- **示例**：
  ```
  clawd/
  ├── Project/
  │   ├── flight-search/          # 航班搜索项目
  │   ├── fencing/                # 击剑规则项目
  │   └── su-ceo-profile/         # 苏总裁事迹项目
  ├── skills/                     # Skill 目录（保留根目录）
  ├── memory/                     # 记忆目录（保留根目录）
  └── AGENTS.md, SOUL.md...       # 核心配置（保留根目录）
  ```

**4.2 必须保留根目录的文件**
以下类型的文件/目录**不应**移入 Project：
- 全局配置：`AGENTS.md`, `SOUL.md`, `TOOLS.md`, `USER.md`, `IDENTITY.md`, `HEARTBEAT.md`
- Skill 目录：`skills/`（全局能力库）
- 记忆目录：`memory/`（跨项目长期记忆）
- 系统目录：`.openclaw/` 等系统生成的目录

**4.3 执行时机**
- **新任务**：创建新项目时，首先在 `Project/` 下创建子目录。
- **旧任务清理**：当发现根目录文件杂乱时，主动提议并按此规范进行整理。

**4.4 外部路径确认原则 (External Path Confirmation)**
- **规则**：若任务需要将新文件生成到 `clawd/Project/` 体系之外的任何位置（例如用户临时指定的 `C:\office\...` 或其他无关目录），**必须先向用户申请权限**。
- **流程**：先说明理由（例如“为了测试方便”），获得用户明确同意后，方可写入。
- **默认**：未经确认，一律优先放在 `clawd/Project/` 内。

## 5. 内容生成与交付规范 (Delivery Protocol)

**核心原则**：
每当生成新的内容（文件、网页、文档）或媒体资源（图片、截图、视频）时，**必须显式告知用户其具体位置**。

**规范行为**：
1. **生成后立即汇报**：在工具调用成功后，回复中必须包含文件的完整路径或可访问链接。
2. **路径格式**：使用绝对路径或基于工作区的相对路径，确保用户能准确找到。
   - 例如：`C:\Users\31509\clawd\Project\summary.md`
3. **针对图片/媒体**：
   - 如果生成了图片（截图、绘图），除了展示图片本身（如支持），必须附带文字说明路径。
   - 示例："已生成长截图：`[MEDIA:path/to/image.jpg]`，文件保存在：`C:\Users\...\image.jpg`"
4. **HTML 网页自动打开**（新增）：
   - 如果生成了 HTML 网页文件，**必须**立即在 Chrome 浏览器中打开（使用 `exec start chrome "file://..."`）。
   - **目的**：让用户可以立即预览效果，无需手动寻找文件。
   - **例外**：如果用户明确说"不要打开"或"稍后我自己看"，则跳过此步骤。

## 6. 系统配置安全修改规范 (Configuration Safety Protocol)

**6.1 确认优先 (Confirm First)**
- **规则**：任何涉及修改 Agnet 系统配置（如 `openclaw.json`、API 设置、模型参数）的操作，**必须**在执行前获得用户的明确书面确认。
- **禁止**：严禁在未确认的情况下擅自调用 `config.apply` 或 `gateway` 更新命令，即使是为了“帮你省事”。

**6.2 强制备份 (Backup First)**
- **规则**：在获得确认并准备修改配置之前，**必须**先将当前的配置文件（如 `openclaw.json`）手动复制一份作为备份。
- **命名建议**：`openclaw.json.bak.YYYYMMDD_HHMM`
- **目的**：确保在配置错误导致系统崩溃时，用户可以通过简单的重命名操作自行恢复。

## 7. 状态自查规范 (Self-Status Verification)

**7.1 场景定义**
当用户询问关于 Agent 自身当前状态的信息时（如“你现在用什么模型？”、“你的配置是什么？”、“你当前的工作目录在哪？”），不可凭记忆或假设回答。

**7.2 强制查询 (Query Before Claim)**
- **规则**：在回答任何关于自身状态的问题前，**必须**先调用相关工具获取实时、准确的数据。
- **示例**：
  - 问模型 → 调用 `session_status` 查看当前 model。
  - 问配置 → 调用 `gateway config.get` 查看配置。
  - 问路径 → 调用 `exec pwd` 或查看环境变量。
- **禁止**：严禁根据历史对话或“应该是…”来推测当前状态。

**7.3 目的**
- 避免因配置回滚、会话切换、系统重启等导致的“认知偏差”。
- 确保用户获得的是 100% 准确的实时信息。

## 8. 工具调用禁忌 (Tool Protocol)

**8.1 严禁使用不存在的工具**
- ❌ **append**: OpenClaw **不存在** `append` 工具。
  - **替代方案**: 若需追加内容，请先 `read` 读取全文，拼接新内容后，使用 `write` 覆写文件。
- ❌ **replace**: OpenClaw **不存在** `replace` 工具。
  - **替代方案**: 使用 `edit` (精确替换) 或 `write` (全量覆写)。

**8.2 文件操作原则**
- **append 幻觉**: 严禁因为习惯而尝试调用 `append`。必须刻意练习使用 `read` + `write` 模式。

---
*此规范适用于所有任务执行场景，优先级高于具体任务的自动补全逻辑。*